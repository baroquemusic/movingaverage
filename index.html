<!DOCTYPE html><head><title>20-day moving daysrage</title></head><body><script>

days = 20

data = new Float64Array( init() )
max = Math.max.apply( Math, data )
min = Math.min.apply( Math, data )
range = max - min
fill = .7

draw()

window.onresize = r => { c.remove(); draw() }

function draw() {

  c = document.createElement( 'canvas' )
  c.width = innerWidth * fill
  c.height = innerHeight * fill
  c.style.border = '1px solid black'
  c.style.position = 'absolute'
  c.style.transform = 'translate( -50%, -50% )'
  c.style.top = c.style.left = '50%'
  document.body.appendChild( c )

  v = c.getContext( '2d' )
  v.fillStyle = 'black'
  vw = c.width / data.length
  vh = c.height / range

  ma = c.getContext( '2d' )
  ma.strokeStyle = 'red'
  ma.lineWidth = vw

  //console.log(c.height+'\n'+vh+'\n'+max+'\n'+min+'\n'+range)

  averages = []

  ma.beginPath()
  
  for( i = 0; i < data.length; i++ ) {

    x = i * vw
    y = c.height - vh - ( max - data[ i ] ) * range / ( range / vh )

    v.fillRect( x, y, vw, vh )

    sum = 0

    for( j = 0; j < days; j++ ) {
    
      sum += c.height - vh - ( max - data[ i + j ] ) * range / ( range / vh )

    }
    
    averages.push( sum / days )

    if( i == 0 ) { ma.moveTo( 0, averages[ 0 ] ) ;console.log(i,averages[i])}


    if( !( i % days ) && i >= days ) {

      ma.bezierCurveTo( 
        ( i - days * 2 / 3 ) * vw,
        averages[ i - days ],
        ( i - days * 1 / 3 ) * vw,
        averages[ i ],
        i * vw,
        averages[ i ]
      )

      console.log(i,averages[i])

    }
    
  }

  console.log(averages.length)

  ma.stroke()

  
}

function init() {

  const raw = '122.07, 123.919998, 124.349998, 124.970001, 129.179993, 129.940002, 130.149994, 132.690002, 133.520004, 137.789993, 137.020004, 137.240005, 137.149994, 137.779999, 137.25, 135.529999, 133.570007, 134.5, 132.520004, 134.259995, 136.100006, 128.820007, 129.350006, 130.820007, 131.580002, 132.940002, 134.210007, 134.759995, 133.589996, 132.869995, 135.029999, 134.830002, 135.339996, 138.220001, 138.020004, 136.039993, 133.660004, 133.910004, 133.350006, 132.630005, 131.619995, 130.630005, 129.75, 128.970001, 127.059998, 127.400002, 125.93, 123.110001, 123.760002, 122.580002, 124.089996, 123.57, 123.019997, 121.580002, 119.910004, 118.839996, 116.900002, 116.919998, 117.099998, 118.5, 115.809998, 116.730003, 116.790001, 116.470001, 116.050003, 116.660004, 118.059998, 118.459999, 118.870003, 118.959999, 120.269997, 120.220001, 120.849998, 124.540001, 123.610001, 120.849998, 121.5392, 120.630974, 120.726578, 119.598473, 120.305923, 119.66539, 121.5392, 122.026772, 122.25621, 122.686424, 135.659653, 135.736145, 136.061188, 138.250473, 137.084137, 134.569794, 134.292542, 136.166351, 136.9216, 135.573608, 136.099426, 136.854691, 137.772461, 137.017212, 132.820267, 133.05928, 131.424469, 132.466537, 131.443588, 130.71701, 128.709366, 127.122368, 128.403442, 129.28299, 130.430206, 131.166351, 130.229446, 132.07457, 130.994263, 131.682602, 132.571701, 131.988525, 133.441681, 133.852768, 133.173996, 134.168259, 132.858505, 133.27916, 132.676865, 133.709366, 133.690247, 133.479919, 132.992355, 131.950287, 133.336517, 136.156784, 137.27533, 136.883362, 136.778198, 135.879547, 135.162521, 135.038239, 137.753342, 136.491394, 136.481842, 137.734222, 135.20076, 134.761002, 135.688339, 135.53537, 136.472275, 136.491394, 135.124283, 134.521988, 135.086044, 133.814529, 131.854691, 132.79158, 134.273422, 133.671127, 134.110901, 134.722748, 135.296371, 134.550674, 133.671127, 132.676865, 133.862335, 140.382416, 140.143402, 139.149139, 138.900574, 140.382416, 139.043976, 138.250473, 139.923523, 140.20076, 136.826004, 139.196945, 141.328873, 142.79158, 143.432129, 144.627151, 143.919693, 144.043976, 142.514343, 141.510513, 140.936905, 139.149139, 139.311661, 137.848953, 137.418732, 137.495224, 137.07457, 137.466537, 138.355637, 138.374756, 137.552582, 136.892929, 137.581268, 138.728485, 138.317398, 137.829834, 135.086044, 137.877625, 139.741867, 139.063095, 141.892929, 138.833649, 139.340347, 138.384323, 135.640533, 137.896744, 136.711288, 135.764816, 135.344162, 136.166351, 135.066925, 137.237091, 132.084137, 127.265778, 127.715103, 126.749519, 126.797325, 125.411087, 128.671127, 129.761002, 129.177826, 128.99617, 128.317398, 129.952194, 127.370934, 127.39962, 128.79541, 129.885284, 130.382416, 127.217972, 124.875717, 124.722755, 124.808792, 123.231361, 124.340347, 123.355644, 122.60038, 122.92543, 121.998085, 121.548759, 122.246651, 118.718925, 119.32122, 117.428299, 114.827919, 116.978966, 115.038239, 115.430206, 113.699806, 117.084129, 117.791588, 115.401527'

  data = raw.split( ',' )

  return data

}

</script></body></html>